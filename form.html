<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pre-Joining Employee Information Form</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <h1>Pre-Joining Employee Information</h1>
        <p class="lead">Please complete all sections. Use <strong>Next</strong> to move forward and
            <strong>Previous</strong> to go back.
        </p>

        <div class="progress" aria-hidden="true">
            <div class="step active" data-step="0">Personal</div>
            <div class="step" data-step="1">Identification</div>
            <div class="step" data-step="2">Education &amp; Employment</div>
            <div class="step" data-step="3">Banking &amp; Tax</div>
        </div>

        <form id="onboardingForm" novalidate enctype="multipart/form-data">
            <!-- PART 1: Personal Information -->
            <fieldset class="active" data-part="1">
                <h2>1. Personal Information</h2>
                <div class="grid">
                    <div>
                        <label for="fullName">Full name (as per ID)</label>
                        <input id="fullName" name="fullName" type="text" required />
                    </div>
                    <div>
                        <label for="dob">Date of birth</label>
                        <input id="dob" name="dob" type="date" required />
                    </div>
                    <div>
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender">
                            <option value="">Select</option>
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                            <option>Prefer not to say</option>
                        </select>
                    </div>
                    <div>
                        <label for="mobile">Mobile number</label>
                        <input id="mobile" name="mobile" type="text" placeholder="+91 98765 43210" />
                    </div>
                    <div class="span-2">
                        <label for="email">Personal email address</label>
                        <input id="email" name="email" type="email" />
                    </div>
                    <div class="span-2">
                        <label for="currentAddress">Current address</label>
                        <textarea id="currentAddress" name="currentAddress"></textarea>
                    </div>
                    <div class="span-2">
                        <label for="permanentAddress">Permanent address</label>
                        <textarea id="permanentAddress" name="permanentAddress"></textarea>
                    </div>
                    <div class="span-2">
                        <label for="emergencyContact">Emergency contact name &amp; number</label>
                        <input id="emergencyContact" name="emergencyContact" type="text" />
                    </div>
                </div>
            </fieldset>

            <!-- PART 2: Identification Documents -->
            <fieldset data-part="2">
                <h2>2. Identification Documents</h2>
                <p class="small">Indicate whether you can provide each document and optionally add details.</p>
                <div class="grid">
                    <div>
                        <label for="drivingLicense">Driving License</label>
                        <input id="drivingLicense" type="text" name="drivingLicense"
                            placeholder="License number / N/A" />
                    </div>
                    <div>
                        <label for="bike">Bike (Registration)</label>
                        <input id="bike" type="text" name="bike" placeholder="Registration / N/A" />
                    </div>
                    <div>
                        <label for="aadhaar">Aadhaar Card</label>
                        <input id="aadhaar" type="text" name="aadhaar" placeholder="Aadhaar number / N/A" />
                    </div>
                    <div>
                        <label for="pan">PAN Card</label>
                        <input id="pan" type="text" name="pan" placeholder="PAN number / N/A" />
                    </div>
                    <div class="span-2">
                        <label for="photo">Passport-size photograph</label>
                        <input id="photo" type="file" name="photo" accept="image/*" />
                    </div>
                </div>
            </fieldset>

            <!-- PART 3: Education & Employment -->
            <fieldset data-part="3">
                <h2>3. Education &amp; Employment Documents</h2>
                <div class="grid">
                    <div class="span-2">
                        <label for="resume">Resume / CV (upload)</label>
                        <input id="resume" type="file" name="resume" accept=".pdf,.doc,.docx" />
                    </div>
                    <div class="span-2">
                        <label for="educationList">Educational certificates (list)</label>
                        <input id="educationList" type="text" name="educationList"
                            placeholder="e.g. B.Tech - University XYZ" />
                    </div>
                    <div>
                        <label for="experienceLetters">Previous employment experience letters</label>
                        <input id="experienceLetters" type="file" name="experienceLetters" multiple />
                    </div>
                    <div>
                        <label for="relievingLetter">Relieving letter from last employer</label>
                        <input id="relievingLetter" type="file" name="relievingLetter" />
                    </div>
                    <div class="span-2">
                        <label for="salarySlips">Last 3-6 months' salary slips</label>
                        <input id="salarySlips" type="file" name="salarySlips" multiple />
                    </div>
                </div>
            </fieldset>
            <!-- PART 4: Banking & Tax Details -->
            <fieldset data-part="4">
                <h2>4. Banking &amp; Tax Details</h2>
                <div class="grid">
                    <div>
                        <label for="bankAccount">Bank account number</label>
                        <input id="bankAccount" name="bankAccount" type="text" />
                    </div>
                    <div>
                        <label for="bankName">Bank name &amp; branch</label>
                        <input id="bankName" name="bankName" type="text" />
                    </div>
                    <div class="span-2">
                        <label for="ifsc">IFSC code</label>
                        <input id="ifsc" name="ifsc" type="text" />
                    </div>
                    <div class="span-2">
                        <label for="taxDetails">Any tax / PAN notes</label>
                        <input id="taxDetails" name="taxDetails" type="text" />
                    </div>
                </div>
            </fieldset>

            <div class="actions">
                <button type="button" id="prevBtn" class="btn ghost">Previous</button>
                <div>
                    <button type="button" id="saveDraft" class="btn ghost">Save Draft</button>
                    <button type="button" id="nextBtn" class="btn">Next</button>
                </div>
            </div>
        </form>

        <footer class="note">This form is based on the Pre-Joining checklist provided for onboarding.</footer>
    </div>

    <script>
        // Simple multi-step form logic
        const form = document.getElementById('onboardingForm');
        const fieldsets = Array.from(form.querySelectorAll('fieldset'));
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const saveBtn = document.getElementById('saveDraft');
        const steps = Array.from(document.querySelectorAll('.step'));
        let idx = 0;

        function updateUI() {
            fieldsets.forEach((fs, i) => fs.classList.toggle('active', i === idx));
            steps.forEach((s, i) => s.classList.toggle('active', i === idx));
            prevBtn.style.visibility = idx === 0 ? 'hidden' : 'visible';
            nextBtn.textContent = idx === fieldsets.length - 1 ? 'Submit' : 'Next';
        }

        nextBtn.addEventListener('click', () => {
            // basic required check for visible inputs
            const current = fieldsets[idx];
            const required = Array.from(current.querySelectorAll('[required]'));
            let ok = true;
            for (const el of required) {
                if (!el.value) {
                    el.style.outline = '2px solid rgba(255,60,60,0.18)';
                    ok = false;
                } else {
                    el.style.outline = '';
                }
            }
            if (!ok) return;

            if (idx < fieldsets.length - 1) {
                idx++;
                updateUI();
            } else {
                // FINAL SUBMIT -> send to backend
                const data = new FormData(form);

                fetch('/api/employees', {
                    method: 'POST',
                    body: data
                })
                    .then((res) => res.json())
                    .then((result) => {
                        if (result.success) {
                            alert('Form submitted successfully! Employee ID: ' + result.id);
                            form.reset();
                            idx = 0;
                            updateUI();
                        } else {
                            alert('Submission failed: ' + (result.message || 'Unknown error'));
                        }
                    })
                    .catch((err) => {
                        console.error('Error submitting form:', err);
                        alert('An error occurred while submitting the form.');
                    });
            }
        });

        prevBtn.addEventListener('click', () => {
            if (idx > 0) {
                idx--;
                updateUI();
            }
        });

        saveBtn.addEventListener('click', () => {
            // Save to localStorage as draft (skip files)
            const data = {};
            new FormData(form).forEach((v, k) => {
                if (v instanceof File) return;
                data[k] = v;
            });
            try {
                localStorage.setItem('onboardingDraft', JSON.stringify(data));
                alert('Draft saved locally.');
            } catch (e) {
                alert('Could not save draft.');
            }
        });

        // allow clicking progress steps
        steps.forEach((s, i) =>
            s.addEventListener('click', () => {
                idx = i;
                updateUI();
            })
        );

        // optional: load draft back
        window.addEventListener('load', () => {
            try {
                const saved = localStorage.getItem('onboardingDraft');
                if (saved) {
                    const obj = JSON.parse(saved);
                    Object.keys(obj).forEach((k) => {
                        const el = form.elements[k];
                        if (el) el.value = obj[k];
                    });
                }
            } catch (e) { }
            updateUI();
        });
    </script>

</body>

</html>